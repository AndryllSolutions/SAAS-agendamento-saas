"""add company_settings table for notification credentials

Revision ID: 6ead18e3f2bd
Revises: 008_add_web_push_notifications
Create Date: 2025-12-04 21:35:36.748798

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '6ead18e3f2bd'
down_revision = '008_add_web_push_notifications'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('company_settings',
    sa.Column('company_id', sa.Integer(), nullable=False),
    sa.Column('email_config', sa.Text(), nullable=True),
    sa.Column('sms_config', sa.Text(), nullable=True),
    sa.Column('whatsapp_config', sa.Text(), nullable=True),
    sa.Column('vapid_config', sa.Text(), nullable=True),
    sa.Column('general_settings', sa.JSON(), nullable=True),
    sa.Column('is_active', sa.Boolean(), nullable=True),
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['company_id'], ['companies.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_company_settings_company_id'), 'company_settings', ['company_id'], unique=True)
    op.create_index(op.f('ix_company_settings_id'), 'company_settings', ['id'], unique=False)
    op.drop_index('idx_anamneses_client_id', table_name='anamneses')
    op.drop_index('idx_anamneses_company_id', table_name='anamneses')
    op.drop_index('idx_anamneses_model_id', table_name='anamneses')
    op.drop_index('idx_anamneses_professional_id', table_name='anamneses')
    op.drop_index('idx_appointments_client_id', table_name='appointments')
    op.drop_index('idx_appointments_company_id', table_name='appointments')
    op.drop_index('idx_appointments_company_start', table_name='appointments')
    op.drop_index('idx_appointments_company_status', table_name='appointments')
    op.drop_index('idx_appointments_professional_id', table_name='appointments')
    op.drop_index('idx_appointments_professional_start', table_name='appointments')
    op.drop_index('idx_appointments_start_time', table_name='appointments')
    op.drop_index('idx_appointments_status', table_name='appointments')
    op.create_index(op.f('ix_appointments_client_crm_id'), 'appointments', ['client_crm_id'], unique=False)
    op.create_foreign_key(None, 'appointments', 'clients', ['client_crm_id'], ['id'], ondelete='SET NULL')
    op.drop_index('idx_cashback_balances_client_id', table_name='cashback_balances')
    op.drop_index('idx_cashback_balances_company_id', table_name='cashback_balances')
    op.drop_index('idx_cashback_rules_company_id', table_name='cashback_rules')
    op.drop_index('idx_cashback_rules_is_active', table_name='cashback_rules')
    op.drop_index('idx_cashback_transactions_balance_id', table_name='cashback_transactions')
    op.drop_index('idx_cashback_transactions_type', table_name='cashback_transactions')
    op.drop_index('idx_clients_company_active', table_name='clients')
    op.drop_index('idx_clients_company_id', table_name='clients')
    op.drop_index('idx_clients_cpf', table_name='clients')
    op.drop_index('idx_clients_email', table_name='clients')
    op.drop_index('idx_clients_is_active', table_name='clients')
    op.drop_index('idx_clients_phone', table_name='clients')
    op.create_index(op.f('ix_clients_user_id'), 'clients', ['user_id'], unique=True)
    op.drop_constraint('clients_user_id_fkey', 'clients', type_='foreignkey')
    op.create_foreign_key(None, 'clients', 'users', ['user_id'], ['id'], ondelete='SET NULL')
    op.drop_index('idx_command_items_command_id', table_name='command_items')
    op.drop_index('idx_command_items_product_id', table_name='command_items')
    op.drop_index('idx_command_items_professional_id', table_name='command_items')
    op.drop_index('idx_command_items_service_id', table_name='command_items')
    op.drop_index('idx_commands_client_date', table_name='commands')
    op.drop_index('idx_commands_client_id', table_name='commands')
    op.drop_index('idx_commands_company_date', table_name='commands')
    op.drop_index('idx_commands_company_id', table_name='commands')
    op.drop_index('idx_commands_date', table_name='commands')
    op.drop_index('idx_commands_status', table_name='commands')
    op.drop_index('idx_commissions_company_id', table_name='commissions')
    op.drop_index('idx_commissions_company_professional', table_name='commissions')
    op.drop_index('idx_commissions_company_status', table_name='commissions')
    op.drop_index('idx_commissions_professional_id', table_name='commissions')
    op.drop_index('idx_commissions_status', table_name='commissions')
    op.drop_index('idx_evaluations_client_id', table_name='evaluations')
    op.drop_index('idx_evaluations_company_id', table_name='evaluations')
    op.drop_index('idx_evaluations_professional_id', table_name='evaluations')
    op.drop_index('idx_evaluations_rating', table_name='evaluations')
    op.drop_index('idx_financial_transactions_company_date', table_name='financial_transactions')
    op.drop_index('idx_financial_transactions_company_id', table_name='financial_transactions')
    op.drop_index('idx_financial_transactions_company_type_date', table_name='financial_transactions')
    op.drop_index('idx_financial_transactions_date', table_name='financial_transactions')
    op.drop_index('idx_financial_transactions_type', table_name='financial_transactions')
    op.drop_index('idx_goals_company_id', table_name='goals')
    op.drop_index('idx_goals_company_period_start', table_name='goals')
    op.drop_index('idx_goals_period_end', table_name='goals')
    op.drop_index('idx_goals_period_start', table_name='goals')
    op.drop_index('idx_goals_professional_id', table_name='goals')
    op.drop_index('idx_invoices_client_id', table_name='invoices')
    op.drop_index('idx_invoices_command_id', table_name='invoices')
    op.drop_index('idx_invoices_company_id', table_name='invoices')
    op.drop_index('idx_invoices_status', table_name='invoices')
    op.drop_index('idx_invoices_type', table_name='invoices')
    op.drop_index('idx_packages_client_id', table_name='packages')
    op.drop_index('idx_packages_company_id', table_name='packages')
    op.drop_index('idx_packages_company_status', table_name='packages')
    op.drop_index('idx_packages_status', table_name='packages')
    op.drop_index('idx_payments_appointment_id', table_name='payments')
    op.drop_index('idx_payments_company_id', table_name='payments')
    op.drop_index('idx_payments_company_status', table_name='payments')
    op.drop_index('idx_payments_created_at', table_name='payments')
    op.drop_index('idx_payments_status', table_name='payments')
    op.drop_index('idx_predefined_packages_company_id', table_name='predefined_packages')
    op.drop_index('idx_predefined_packages_is_active', table_name='predefined_packages')
    op.alter_column('products', 'image_url',
               existing_type=sa.TEXT(),
               type_=sa.String(length=500),
               existing_nullable=True)
    op.drop_index('idx_products_brand_id', table_name='products')
    op.drop_index('idx_products_category_id', table_name='products')
    op.drop_index('idx_products_company_active', table_name='products')
    op.drop_index('idx_products_company_id', table_name='products')
    op.drop_index('idx_products_is_active', table_name='products')
    op.drop_index('idx_promotions_company_id', table_name='promotions')
    op.drop_index('idx_promotions_is_active', table_name='promotions')
    op.drop_index('idx_promotions_valid_from', table_name='promotions')
    op.drop_index('idx_promotions_valid_until', table_name='promotions')
    op.drop_index('idx_purchases_company_date', table_name='purchases')
    op.drop_index('idx_purchases_company_id', table_name='purchases')
    op.drop_index('idx_purchases_purchase_date', table_name='purchases')
    op.drop_index('idx_purchases_status', table_name='purchases')
    op.drop_index('idx_purchases_supplier_id', table_name='purchases')
    op.add_column('reviews', sa.Column('client_crm_id', sa.Integer(), nullable=True))
    op.create_index(op.f('ix_reviews_client_crm_id'), 'reviews', ['client_crm_id'], unique=False)
    op.create_foreign_key(None, 'reviews', 'clients', ['client_crm_id'], ['id'], ondelete='SET NULL')
    op.drop_index('idx_services_company_active', table_name='services')
    op.drop_index('idx_services_company_id', table_name='services')
    op.drop_index('idx_services_is_active', table_name='services')
    op.drop_index('idx_subscription_sales_client_id', table_name='subscription_sales')
    op.drop_index('idx_subscription_sales_company_id', table_name='subscription_sales')
    op.drop_index('idx_subscription_sales_model_id', table_name='subscription_sales')
    op.drop_index('idx_subscription_sales_status', table_name='subscription_sales')
    op.drop_index('idx_suppliers_company_id', table_name='suppliers')
    op.drop_index('idx_suppliers_name', table_name='suppliers')
    op.alter_column('users', 'avatar_url',
               existing_type=sa.TEXT(),
               type_=sa.String(length=500),
               existing_nullable=True)
    op.drop_index('idx_users_company_id', table_name='users')
    op.drop_index('idx_users_company_role', table_name='users')
    op.drop_index('idx_users_email', table_name='users')
    op.drop_index('idx_users_is_active', table_name='users')
    op.drop_index('idx_users_role', table_name='users')
    op.add_column('waitlist', sa.Column('client_crm_id', sa.Integer(), nullable=True))
    op.create_index(op.f('ix_waitlist_client_crm_id'), 'waitlist', ['client_crm_id'], unique=False)
    op.create_foreign_key(None, 'waitlist', 'clients', ['client_crm_id'], ['id'], ondelete='SET NULL')
    op.drop_index('idx_whatsapp_campaigns_company_id', table_name='whatsapp_campaigns')
    op.drop_index('idx_whatsapp_campaigns_created_at', table_name='whatsapp_campaigns')
    op.drop_index('idx_whatsapp_campaigns_status', table_name='whatsapp_campaigns')
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_index('idx_whatsapp_campaigns_status', 'whatsapp_campaigns', ['status'], unique=False)
    op.create_index('idx_whatsapp_campaigns_created_at', 'whatsapp_campaigns', ['created_at'], unique=False)
    op.create_index('idx_whatsapp_campaigns_company_id', 'whatsapp_campaigns', ['company_id'], unique=False)
    op.drop_constraint(None, 'waitlist', type_='foreignkey')
    op.drop_index(op.f('ix_waitlist_client_crm_id'), table_name='waitlist')
    op.drop_column('waitlist', 'client_crm_id')
    op.create_index('idx_users_role', 'users', ['role'], unique=False)
    op.create_index('idx_users_is_active', 'users', ['is_active'], unique=False)
    op.create_index('idx_users_email', 'users', ['email'], unique=False)
    op.create_index('idx_users_company_role', 'users', ['company_id', 'role'], unique=False)
    op.create_index('idx_users_company_id', 'users', ['company_id'], unique=False)
    op.alter_column('users', 'avatar_url',
               existing_type=sa.String(length=500),
               type_=sa.TEXT(),
               existing_nullable=True)
    op.create_index('idx_suppliers_name', 'suppliers', ['name'], unique=False)
    op.create_index('idx_suppliers_company_id', 'suppliers', ['company_id'], unique=False)
    op.create_index('idx_subscription_sales_status', 'subscription_sales', ['status'], unique=False)
    op.create_index('idx_subscription_sales_model_id', 'subscription_sales', ['model_id'], unique=False)
    op.create_index('idx_subscription_sales_company_id', 'subscription_sales', ['company_id'], unique=False)
    op.create_index('idx_subscription_sales_client_id', 'subscription_sales', ['client_id'], unique=False)
    op.create_index('idx_services_is_active', 'services', ['is_active'], unique=False)
    op.create_index('idx_services_company_id', 'services', ['company_id'], unique=False)
    op.create_index('idx_services_company_active', 'services', ['company_id', 'is_active'], unique=False)
    op.drop_constraint(None, 'reviews', type_='foreignkey')
    op.drop_index(op.f('ix_reviews_client_crm_id'), table_name='reviews')
    op.drop_column('reviews', 'client_crm_id')
    op.create_index('idx_purchases_supplier_id', 'purchases', ['supplier_id'], unique=False)
    op.create_index('idx_purchases_status', 'purchases', ['status'], unique=False)
    op.create_index('idx_purchases_purchase_date', 'purchases', ['purchase_date'], unique=False)
    op.create_index('idx_purchases_company_id', 'purchases', ['company_id'], unique=False)
    op.create_index('idx_purchases_company_date', 'purchases', ['company_id', 'purchase_date'], unique=False)
    op.create_index('idx_promotions_valid_until', 'promotions', ['valid_until'], unique=False)
    op.create_index('idx_promotions_valid_from', 'promotions', ['valid_from'], unique=False)
    op.create_index('idx_promotions_is_active', 'promotions', ['is_active'], unique=False)
    op.create_index('idx_promotions_company_id', 'promotions', ['company_id'], unique=False)
    op.create_index('idx_products_is_active', 'products', ['is_active'], unique=False)
    op.create_index('idx_products_company_id', 'products', ['company_id'], unique=False)
    op.create_index('idx_products_company_active', 'products', ['company_id', 'is_active'], unique=False)
    op.create_index('idx_products_category_id', 'products', ['category_id'], unique=False)
    op.create_index('idx_products_brand_id', 'products', ['brand_id'], unique=False)
    op.alter_column('products', 'image_url',
               existing_type=sa.String(length=500),
               type_=sa.TEXT(),
               existing_nullable=True)
    op.create_index('idx_predefined_packages_is_active', 'predefined_packages', ['is_active'], unique=False)
    op.create_index('idx_predefined_packages_company_id', 'predefined_packages', ['company_id'], unique=False)
    op.create_index('idx_payments_status', 'payments', ['status'], unique=False)
    op.create_index('idx_payments_created_at', 'payments', ['created_at'], unique=False)
    op.create_index('idx_payments_company_status', 'payments', ['company_id', 'status'], unique=False)
    op.create_index('idx_payments_company_id', 'payments', ['company_id'], unique=False)
    op.create_index('idx_payments_appointment_id', 'payments', ['appointment_id'], unique=False)
    op.create_index('idx_packages_status', 'packages', ['status'], unique=False)
    op.create_index('idx_packages_company_status', 'packages', ['company_id', 'status'], unique=False)
    op.create_index('idx_packages_company_id', 'packages', ['company_id'], unique=False)
    op.create_index('idx_packages_client_id', 'packages', ['client_id'], unique=False)
    op.create_index('idx_invoices_type', 'invoices', ['invoice_type'], unique=False)
    op.create_index('idx_invoices_status', 'invoices', ['status'], unique=False)
    op.create_index('idx_invoices_company_id', 'invoices', ['company_id'], unique=False)
    op.create_index('idx_invoices_command_id', 'invoices', ['command_id'], unique=False)
    op.create_index('idx_invoices_client_id', 'invoices', ['client_id'], unique=False)
    op.create_index('idx_goals_professional_id', 'goals', ['professional_id'], unique=False)
    op.create_index('idx_goals_period_start', 'goals', ['period_start'], unique=False)
    op.create_index('idx_goals_period_end', 'goals', ['period_end'], unique=False)
    op.create_index('idx_goals_company_period_start', 'goals', ['company_id', 'period_start'], unique=False)
    op.create_index('idx_goals_company_id', 'goals', ['company_id'], unique=False)
    op.create_index('idx_financial_transactions_type', 'financial_transactions', ['type'], unique=False)
    op.create_index('idx_financial_transactions_date', 'financial_transactions', ['date'], unique=False)
    op.create_index('idx_financial_transactions_company_type_date', 'financial_transactions', ['company_id', 'type', 'date'], unique=False)
    op.create_index('idx_financial_transactions_company_id', 'financial_transactions', ['company_id'], unique=False)
    op.create_index('idx_financial_transactions_company_date', 'financial_transactions', ['company_id', 'date'], unique=False)
    op.create_index('idx_evaluations_rating', 'evaluations', ['rating'], unique=False)
    op.create_index('idx_evaluations_professional_id', 'evaluations', ['professional_id'], unique=False)
    op.create_index('idx_evaluations_company_id', 'evaluations', ['company_id'], unique=False)
    op.create_index('idx_evaluations_client_id', 'evaluations', ['client_id'], unique=False)
    op.create_index('idx_commissions_status', 'commissions', ['status'], unique=False)
    op.create_index('idx_commissions_professional_id', 'commissions', ['professional_id'], unique=False)
    op.create_index('idx_commissions_company_status', 'commissions', ['company_id', 'status'], unique=False)
    op.create_index('idx_commissions_company_professional', 'commissions', ['company_id', 'professional_id'], unique=False)
    op.create_index('idx_commissions_company_id', 'commissions', ['company_id'], unique=False)
    op.create_index('idx_commands_status', 'commands', ['status'], unique=False)
    op.create_index('idx_commands_date', 'commands', ['date'], unique=False)
    op.create_index('idx_commands_company_id', 'commands', ['company_id'], unique=False)
    op.create_index('idx_commands_company_date', 'commands', ['company_id', 'date'], unique=False)
    op.create_index('idx_commands_client_id', 'commands', ['client_id'], unique=False)
    op.create_index('idx_commands_client_date', 'commands', ['client_id', 'date'], unique=False)
    op.create_index('idx_command_items_service_id', 'command_items', ['service_id'], unique=False)
    op.create_index('idx_command_items_professional_id', 'command_items', ['professional_id'], unique=False)
    op.create_index('idx_command_items_product_id', 'command_items', ['product_id'], unique=False)
    op.create_index('idx_command_items_command_id', 'command_items', ['command_id'], unique=False)
    op.drop_constraint(None, 'clients', type_='foreignkey')
    op.create_foreign_key('clients_user_id_fkey', 'clients', 'users', ['user_id'], ['id'])
    op.drop_index(op.f('ix_clients_user_id'), table_name='clients')
    op.create_index('idx_clients_phone', 'clients', ['phone'], unique=False)
    op.create_index('idx_clients_is_active', 'clients', ['is_active'], unique=False)
    op.create_index('idx_clients_email', 'clients', ['email'], unique=False)
    op.create_index('idx_clients_cpf', 'clients', ['cpf'], unique=False)
    op.create_index('idx_clients_company_id', 'clients', ['company_id'], unique=False)
    op.create_index('idx_clients_company_active', 'clients', ['company_id', 'is_active'], unique=False)
    op.create_index('idx_cashback_transactions_type', 'cashback_transactions', ['transaction_type'], unique=False)
    op.create_index('idx_cashback_transactions_balance_id', 'cashback_transactions', ['balance_id'], unique=False)
    op.create_index('idx_cashback_rules_is_active', 'cashback_rules', ['is_active'], unique=False)
    op.create_index('idx_cashback_rules_company_id', 'cashback_rules', ['company_id'], unique=False)
    op.create_index('idx_cashback_balances_company_id', 'cashback_balances', ['company_id'], unique=False)
    op.create_index('idx_cashback_balances_client_id', 'cashback_balances', ['client_id'], unique=False)
    op.drop_constraint(None, 'appointments', type_='foreignkey')
    op.drop_index(op.f('ix_appointments_client_crm_id'), table_name='appointments')
    op.create_index('idx_appointments_status', 'appointments', ['status'], unique=False)
    op.create_index('idx_appointments_start_time', 'appointments', ['start_time'], unique=False)
    op.create_index('idx_appointments_professional_start', 'appointments', ['professional_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_professional_id', 'appointments', ['professional_id'], unique=False)
    op.create_index('idx_appointments_company_status', 'appointments', ['company_id', 'status'], unique=False)
    op.create_index('idx_appointments_company_start', 'appointments', ['company_id', 'start_time'], unique=False)
    op.create_index('idx_appointments_company_id', 'appointments', ['company_id'], unique=False)
    op.create_index('idx_appointments_client_id', 'appointments', ['client_id'], unique=False)
    op.create_index('idx_anamneses_professional_id', 'anamneses', ['professional_id'], unique=False)
    op.create_index('idx_anamneses_model_id', 'anamneses', ['model_id'], unique=False)
    op.create_index('idx_anamneses_company_id', 'anamneses', ['company_id'], unique=False)
    op.create_index('idx_anamneses_client_id', 'anamneses', ['client_id'], unique=False)
    op.drop_index(op.f('ix_company_settings_id'), table_name='company_settings')
    op.drop_index(op.f('ix_company_settings_company_id'), table_name='company_settings')
    op.drop_table('company_settings')
    # ### end Alembic commands ###

